<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Sparkles Mount Ommaney</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/favicon-32x32.png" type="image/png" />
    <meta name="theme-color" content="#fcce09" />

    <!-- iOS PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Sparkles" />
    <link rel="apple-touch-icon" href="icons/512.png" />

    <style>
      body {
        font-family: system-ui, Arial, sans-serif;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: white;
        color: #333;
        text-align: center;
      }
      button {
        background: linear-gradient(to right, #fcce09, #ff8a65);
        border: none;
        color: white;
        font-size: 16px;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s ease;
      }
      button:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <img src="icons/512.png" alt="Sparkles Logo" width="96" height="96" />
    <h1>Sparkles Mount Ommaney</h1>
    <p>Launch the Sparkles Mount Ommaney App.</p>
    <button id="openAppBtn">Open App Now.</button>

    <script>
      const APP_URL = "https://script.google.com/macros/s/AKfycbxNSH10hbqT6PR3maO9VFoCG_huLf19TSxSM7FskuHAUcjK0DBLoECIj8JCQ5fpIq3Bxw/exec";

      // Service Worker registration
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("service-worker.js")
          .then((reg) => console.log("✅ Service Worker registered:", reg.scope))
          .catch((err) => console.warn("⚠️ SW registration failed:", err));
      }

      // Handle "beforeinstallprompt"
      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;

        const installBtn = document.createElement("button");
        installBtn.textContent = "Install Sparkles App";
        installBtn.style =
          "position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:12px 20px;font-size:16px;border:none;border-radius:8px;background:#FF8A65;color:white;z-index:9999;";
        document.body.appendChild(installBtn);

        installBtn.addEventListener("click", async () => {
          installBtn.remove();
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log("User response to install:", outcome);
          deferredPrompt = null;
        });
      });

      // Open GAS Web App
      document.getElementById("openAppBtn").addEventListener("click", () => {
        window.location.href = APP_URL;
      });

      // Optional: show hint for iOS users
      if (/iphone|ipad|ipod/i.test(navigator.userAgent)) {
        setTimeout(() => {
          alert("To install Sparkles, tap the Share icon (⬆️) then ‘Add to Home Screen’.");
        }, 2000);
      }
    </script>
  </body>
</html>
